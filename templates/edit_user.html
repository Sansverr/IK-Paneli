{% extends "base.html" %}

{% block title %}Kullanıcı Düzenle: {{ user.username }}{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Kullanıcı Düzenle: <span class="text-indigo-600">{{ user.username }}</span></h1>
    <a href="{{ url_for('user_management') }}" class="inline-flex items-center justify-center rounded-md bg-gray-200 px-4 py-2 text-sm font-semibold text-gray-800 shadow-sm hover:bg-gray-300">
        Geri Dön
    </a>
</div>

<div class="bg-white rounded-lg shadow p-8 max-w-2xl mx-auto">
    <form action="{{ url_for('edit_user', user_id=user.id) }}" method="POST" class="space-y-6">
        <div>
            <label for="username" class="block text-sm font-medium text-gray-700">Kullanıcı Adı (Değiştirilemez)</label>
            <input type="text" name="username" id="username" value="{{ user.username }}" disabled class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-100">
        </div>

        <div>
            <label for="password" class="block text-sm font-medium text-gray-700">Yeni Şifre (Değiştirmek istemiyorsanız boş bırakın)</label>
            <input type="password" name="password" id="password" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
        </div>

        <div>
            <label for="role" class="block text-sm font-medium text-gray-700">Yetki (Rol)</label>
            <select name="role" id="role" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2" {% if user.id == session.user_id %}disabled{% endif %}>
                <option value="user" {% if user.role == 'user' %}selected{% endif %}>Kullanıcı</option>
                <option value="manager" {% if user.role == 'manager' %}selected{% endif %}>Yönetici (Manager)</option>
                <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>
            </select>
        </div>

        <div>
            <label for="calisan_id" class="block text-sm font-medium text-gray-700">Bağlı Personel Profili</label>
            <select name="calisan_id" id="calisan_id" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2" {% if user.id == session.user_id %}disabled{% endif %}>
                <option value="">Personel Bağlantısı Yok</option>

                {# Mevcut bağlı personeli seçili olarak ekle #}
                {% if current_personnel %}
                <option value="{{ current_personnel.id }}" selected>{{ current_personnel.ad_soyad }} (Sicil: {{ current_personnel.sicil_no }})</option>
                {% endif %}

                {# Sonra diğer bağlanmamış personelleri listele #}
                {% for p in unlinked_personnel %}
                    {# Sadece mevcut bağlı personel değilse listeye ekle #}
                    {% if not current_personnel or p.id != current_personnel.id %}
                    <option value="{{ p.id }}">{{ p.ad_soyad }} (Sicil: {{ p.sicil_no }})</option>
                    {% endif %}
                {% endfor %}
            </select>
            {% if user.id == session.user_id %}
                <p class="text-xs text-gray-500 mt-1">Kendi personel bağlantınızı değiştiremezsiniz.</p>
            {% endif %}
        </div>

        <div class="flex justify-end pt-4 border-t">
            <button type="submit" class="rounded-md bg-indigo-600 px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">Değişiklikleri Kaydet</button>
        </div>
    </form>
</div>
{% endblock %}